{% extends "layout.html" %}
{% block content %}

<div class="row">
    <div class="col-sm-12">              
        <div class="form-check">
        {% set ns = namespace(count=0, comp_level=0, parent='0-00') %}                
        {% for i in data %}                                         
            {% set m_parent = i["m_parent"] %}                  
            {% set m_id = i["m_id"] %}    
            {% if not i["m_parent"] %}    
                {% set ns.parent = i["m_id"] %}                              
                <input id="{{ i['m_id'] }}"  class="form-check-input" type="checkbox" id="item1" onclick="checkChild('{{ m_id }}', '{{ m_id }}')">
                <label class="form-check-label" for="item1">
                    {{ i["m_desc"] }}
                </label>
            {% else %}                
                {% if i["m_level"] < ns.comp_level %}                                                                      
                    </div>
                    </div>                    
                {% endif %}
            <div class="tree-list">
                <div class="form-check">                      
                    <input id="{{ i['m_id'] }}"  class="form-check-input" type="checkbox" id="item2" data-parent="['{{ i['m_parent'] }}', '{{ns.parent}}']" onclick="checkChild('{{ns.parent}}', '{{ m_id }}')">
                    <label class="form-check-label" for="item2">
                        {{ i["m_desc"] }}
                    </label>                    
                {% if i["m_link"] %}  
                    {% set ns.count = ns.count + 1 %}                              
                    </div>            
                        </div>
                {% endif %}   
                                                                
                {% set ns.comp_level = i["m_level"] %}
            {% endif %}            
        {% endfor %}                              
        </div>  
    </div>
</div>

{% endblock content %}

{% block script %}
<script type="text/javascript">
    function checkChild(parent, id) {                                
        // slice depan id sama check true        
        $('input[data-parent*="' + id + '"]').prop('checked', $('#' + id).prop('checked'));
        $('input[data-parent*="' + id + '"]').attr('disabled', $('#' + id).prop('checked'));     
        
        if ($('input[data-parent*="' + parent + '"]:checked').length == $('input[data-parent*="' + parent + '"]').length) {
            $(`#${parent}`).prop("checked", true)
        } else {
            $(`#${parent}`).prop("checked", false)
        }
    }
</script>
{% endblock script %}